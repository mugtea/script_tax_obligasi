ALTER   PROCEDURE [dbo].[TaxUpdateIDRequest]   
as    
begin    
    
drop table if exists tempListUpdateIDRequestTax     
--select trl.id , s.FK_TaxRequestList  
--into tempListUpdateIDRequestTax   
--From FileData a     
-- inner join MappingStatementFileData b on a.Pk_FileData_Id = b.Fk_FileData_Id    
-- inner join Statement s on s.Pk_Statement_Id = b.Fk_Statement_Id    
-- inner join TaxRequestList trl on trl.cif = s.CIFNo    
--   where   
--   trl.status in ('waiting','failed')    
--   and s.FK_TaxRequestList is null   
--   --AND s.Fk_MsStatementTemplate_Id = @FKStatementTemplateId    
    
--update s set s.FK_TaxRequestList = trl.id  From FileData a     
-- left join MappingStatementFileData b on a.Pk_FileData_Id = b.Fk_FileData_Id    
-- left join Statement s on s.Pk_Statement_Id = b.Fk_Statement_Id    
-- left join TaxRequestList trl on trl.cif = s.CIFNo    
--   where trl.status in ('waiting','failed')    
--   and s.FK_TaxRequestList is null   
--   --AND s.Fk_MsStatementTemplate_Id = @FKStatementTemplateId    
--   and trl.id in (select id from tempListUpdateIDRequestTax)    
    
----update trl set trl.status = 'Success' From TaxRequestList trl     
----   where trl.id in (select id from tempListUpdateIDRequestTax)    
    
	-- select trl.id , s.FK_TaxRequestList into tempListUpdateIDRequestTax  
	-- From FileData a     
 --inner join MappingStatementFileData b on a.Pk_FileData_Id = b.Fk_FileData_Id    
 --inner join Statement s on s.Pk_Statement_Id = b.Fk_Statement_Id    
 --inner join TaxRequestList trl on trl.id = s.PostalCode --ini fk_taxrequestlist    
 --where trl.status in ('waiting','failed')    
 --  and s.FK_TaxRequestList is null  or s.FK_TaxRequestList <> trl.id 

	-- UPDATE s set FK_TaxRequestList = trl.id  From FileData a     
 --inner join MappingStatementFileData b on a.Pk_FileData_Id = b.Fk_FileData_Id    
 --inner join Statement s on s.Pk_Statement_Id = b.Fk_Statement_Id    
 --inner join TaxRequestList trl on trl.id = s.PostalCode --ini fk_taxrequestlist    
 --where trl.status in ('waiting','failed')    
 --  and s.FK_TaxRequestList is null  or s.FK_TaxRequestList <> trl.id 


  select s.PostalCode AS ID , s.PostalCode AS FK_TaxRequestList into tempListUpdateIDRequestTax  
	 From FileData a     
 inner join MappingStatementFileData b on a.Pk_FileData_Id = b.Fk_FileData_Id    
 inner join Statement s on s.Pk_Statement_Id = b.Fk_Statement_Id    
 where s.FK_TaxRequestList is null  or s.FK_TaxRequestList <> s.PostalCode 

	 UPDATE s set FK_TaxRequestList = s.PostalCode  From FileData a     
 inner join MappingStatementFileData b on a.Pk_FileData_Id = b.Fk_FileData_Id    
 inner join Statement s on s.Pk_Statement_Id = b.Fk_Statement_Id    
 where s.FK_TaxRequestList is null  or s.FK_TaxRequestList <> s.PostalCode

 update a set a.FileDataName = b.FileName from FileData a inner join vw_TaxCustomerDeductedAdvice_OBS_GetUngeneratedFile b on a.Pk_FileData_Id = b.Pk_FileData_Id 

end